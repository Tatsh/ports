# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                chrome-remote-desktop
version             88.0.4324.33
maintainers         {gmail.com:audvare @Tatsh}
license             Restricted
description         Remote desktop service, provided by Google.
long_description    ${description}
homepage            https://remotedesktop.google.com/
master_sites        https://dl.google.com/chrome-remote-desktop/
distfiles           chromeremotedesktop.dmg
categories          net aqua
platforms           macosx

checksums           rmd160  31bbedd4dce5204b3c65e545af0efd9aa74b3388 \
                    sha256  e040ef41f367315223dc00d3ff94845a68afebc50bedd0b2c9e5de052c0ffe17 \
                    size    55312870

livecheck.type      md5
livecheck.url       https://dl.google.com/chrome-remote-desktop/${distfiles}
livecheck.md5       4fb5efe88ed0b2928616d43663b98a43

use_configure       no
use_dmg             yes
extract.only        chromeremotedesktop.dmg
extract.mkdir       no

destroot.violate_mtree  yes

if {${os.major} < 14} {
    pre-fetch {
        ui_error "${name} @${version} requires OS X 10.10 or later."
        return -code error "incompatible OS X version"
    }
}

post-extract {
    exec pkgutil --expand "${worksrcpath}/Chrome Remote Desktop Host.pkg" ${worksrcpath}/rdh
    system "cd \"${worksrcpath}/rdh/ChromeRemoteDesktopHostService.pkg\" && cpio -i < Payload"
}

build {}

destroot {
    file copy {*}[glob -nocomplain -directory ${worksrcpath}/rdh/ChromeRemoteDesktopHostService.pkg/Library *] ${destroot}/Library/
}

post-destroot {
    ui_msg "******************************************************"
    ui_msg "*"
    ui_msg "* To start the service:"
    ui_msg "*"
    ui_msg "    launchctl load -w -S Aqua /Library/LaunchAgents/org.chromium.chromoting.plist"
    ui_msg "    launchctl start /Library/LaunchAgents/org.chromium.chromoting.plist"
    ui_msg "*"
    ui_msg "* Install the Chrome extension: https://chrome.google.com/webstore/detail/chrome-remote-desktop/inomeogfingihgjfjlpeplalcfajhgai/"
    ui_msg "* Then go to https://remotedesktop.google.com/access/ to finish configuration."
    ui_msg "*"
    ui_msg "******************************************************"
}
