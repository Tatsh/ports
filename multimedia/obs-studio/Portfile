PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.1

github.setup        obsproject obs-studio 23.0.2

checksums           rmd160  8997614167c876382c4e4183365743af26618882 \
                    sha256  b5f2a3600aa74a092aa3c142ec983ffb12a5a20676a95bb3db78105161491b4e \
                    size    6226582

version             23.0.2
categories          multimedia audio net aqua
description         Free and open source software for live streaming and screen recording.
long_description    ${description}
maintainers         {gmail.com:audvare @Tatsh}
platforms           darwin freebsd
license             GPL-2

depends_lib \
    port:qt5-kde \
    port:curl \
    port:ffmpeg \
    port:jansson

configure.args-append \
    -DDISABLE_ALSA=yes \
    -DDISABLE_LIBFDK=yes \
    -DDISABLE_V4L2=yes \
    -DDISABLE_PYTHON=yes \
    -DDISABLE_SPEEXDSP=yes \
    -DDISABLE_JACK=yes \
    -DDISABLE_PLUGINS=yes \
    -DBUILD_REDISTRIBUTABLE=yes \
    -DUNIX_STRUCTURE=yes \
    -DOBS_VERSION_OVERRIDE=${version}

variant imagemagick description "Use ImageMagick for image loading instead of ffmpeg." {
    depends_lib-append port:imagemagick
    configure.args-append -DLIBOBS_PREFER_IMAGEMAGICK=yes
}

variant jack description "JACK support" {
    depends_lib-append port:jack
    configure.args-append -DDISABLE_JACK=no
}

variant luajit description "Enable Lua scripting" {
    depends_lib-append port:luajit
    depends_build-append port:swig
    configure.args-append -DDISABLE_LUA=no -DENABLE_SCRIPTING=yes
}

variant pulseaudio description "Enable PulseAudio" {
    depends_lib-append port:pulseaudio
    configure.args-append -DDISABLE_PULSEAUDIO=no
}

variant python37 description "Enable Python scripting" {
    depends_lib-append port:python37
    depends_build-append port:swig
    configure.args-append -DDISABLE_PYTHON=no -DENABLE_SCRIPTING=yes
}
variant speex description "Enable noise suppression filter support via SpeexDSP." {
    depends_lib-append port:speexDSP
    configure.args-append -DDISABLE_SPEEXDSP=no
}

variant truetype description "FreeType support" {
    depends_lib-append port:freetype port:fontconfig
    configure.args-append -DDISABLE_FREETYPE=no
}

patch {
    reinplace "562s|TARGET_SONAME_FILE_NAME|TARGET_FILE_NAME|" \
        "${worksrcpath}/cmake/Modules/ObsHelpers.cmake"
}
