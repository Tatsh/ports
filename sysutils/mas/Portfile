# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           xcode 1.0
PortGroup           github 1.0

github.setup        mas-cli mas 1.8.1 v
revision            0

license             MIT
maintainers         {gmail.com:audvare @Tatsh}
description         Mac App Store command line interface.
long_description    ${description}
categories          sysutils aqua

checksums           rmd160  f5db73445c37aee6e723953b2f9564e5f097aa72 \
                    sha256  3848dc246217338899981072c4c2ece2e98fd415c160adec1f4c4f826178ac5f \
                    size    3333823

depends_lib         port:Commandant

xcode.target        mas
xcode.configuration Release
xcode.build.settings \
    CODE_SIGN_IDENTITY=- \
    CODE_SIGN_STYLE=Manual
xcode.destroot.settings \
    CODE_SIGN_IDENTITY=- \
    CODE_SIGN_STYLE=Manual

patchfiles          patch-system-libs.diff

post-patch {
    reinplace "s|@executable_path/../Frameworks |${frameworks_dir} |g" \
        ${worksrcpath}/mas-cli.xcodeproj/project.pbxproj
}

if {${os.major} < 15} {
    pre-fetch {
        ui_error "${name} @${version} requires OS X 10.11 or later."
        return -code error "incompatible OS X version"
    }
}

destroot {
    file copy ${worksrcpath}/build/Release/MasKit.framework \
        ${destroot}${frameworks_dir}
    xinstall -m 755 ${worksrcpath}/build/Release/mas ${destroot}${prefix}/bin/mas
}
