# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
PortSystem          1.0
PortGroup           cmake 1.1

set gh_user         stepmania
set gh_project      stepmania
set gh_commit       3c8ee86

name                ${gh_project}
version             5.1.0_beta2_p20190310
categories          games
platforms           darwin
license             MIT
maintainers         nomaintainer
description         Rhythm game.
long_description    StepMania is a free dance and rhythm game.

homepage            https://github.com/${gh_user}/${gh_project}
master_sites        ${homepage}/tarball/${gh_commit}
distname            ${gh_project}-${gh_commit}
worksrcdir          ${gh_user}-${distname}

checksums           rmd160  237c4d1463ebe3fee792e7f55530f6f570fc15c3 \
                    sha256  fba293230fa641798d1ed7326d04762435b261bc05b82d10c527c8e70dea72ec \
                    size    186427476

depends_build-append port:yasm
depends_lib port:libmad \
    port:libvorbis \
    port:jpeg \
    port:ffmpeg \
    port:glew \
    port:pcre \
    port:libogg

configure.args-append \
		-DWITH_FULL_RELEASE=yes \
		-DWITH_PORTABLE_TOMCRYPT=no \
		-DWITH_GLES2=yes \
		-DWITH_JPEG=yes \
		-DWITH_OGG=yes \
		-DWITH_WAV=yes \
		-DWITH_SYSTEM_GLEW=yes \
		-DWITH_SYSTEM_TOMMATH=yes \
		-DWITH_SYSTEM_ZLIB=yes \
		-DWITH_SYSTEM_JSONCPP=no \
		-DWITH_SYSTEM_PNG=no \
		-DWITH_SYSTEM_JPEG=yes \
		-DWITH_SYSTEM_PCRE=yes \
		-DWITH_SYSTEM_OGG=yes

variant networking description {Networking support} {
	configure.args-append -DWITH_NETWORKING=yes
}

variant ffmpeg description {Enable ffmpeg} {
    configure.args-append -DWITH_FFMPEG=yes -DWITH_SYSTEM_FFMPEG=yes
}

variant crash_handler description {Enable crash handler} {
    configure.args-append -DWITH_CRASH_HANDLER=yes
}

variant gpl description {Enable GPL code (non-distributable binary)} {
    configure.args-append -DWITH_GPL_LIBS=yes -DWITH_MP3=yes -DWITH_SYSTEM_MAD=yes
}

variant lto description {Enable link time optimisation} {
	configure.args-append -DWITH_LTO=yes
}

# variant bundled_songs description {Do not install bundled songs} {}

# variant bundled_courses description {Do not install bundled courses} {}

default_variants    +networking +ffmpeg +crash_handler +gpl

destroot {
    set dirnames {Announcers BGAnimations BackgroundEffects
                  BackgroundTransitions Characters Courses
                  Data Docs Manual NoteSkins Scripts Songs Themes
                  StepMania.app}
    xinstall -d "${destroot}/${applications_dir}/StepMania/"
    foreach dir $dirnames {
        file copy "${worksrcpath}/${dir}" "${destroot}/${applications_dir}/StepMania/"
    }
}
