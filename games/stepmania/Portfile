PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0

github.setup            stepmania stepmania 4977f29
github.livecheck.branch 5_1-new

version             5.1.0_beta2_p20190328
categories          games
platforms           darwin linux freebsd
license             MIT
maintainers         {gmail.com:audvare @Tatsh}
description         Rhythm game.
long_description    StepMania is a free dance and rhythm game.

checksums           rmd160  a2950408283ccf6ddbe5f8ca39fdb5a35d61197b \
                    sha256  01bd4fdbaf5ea7e638b7b0206d6b2e396e8e063daaf43e262949b51648d55fda \
                    size    186514195

patchfiles          noexcept.patch \
                    glew-link.patch \
                    catalina-rev.patch \
                    catalina2.patch
patch.pre_args      -p1 -R

depends_build-append port:yasm
depends_lib \
    port:libvorbis \
    port:jpeg \
    port:glew \
    port:pcre \
    port:libogg \
    port:libtommath

configure.args-append \
    -DWITH_FULL_RELEASE=yes \
    -DWITH_PORTABLE_TOMCRYPT=no \
    -DWITH_GLES2=yes \
    -DWITH_JPEG=yes \
    -DWITH_OGG=yes \
    -DWITH_WAV=yes \
    -DWITH_SYSTEM_GLEW=yes \
    -DWITH_SYSTEM_TOMMATH=yes \
    -DWITH_SYSTEM_ZLIB=yes \
    -DWITH_SYSTEM_JSONCPP=no \
    -DWITH_SYSTEM_PNG=no \
    -DWITH_SYSTEM_JPEG=yes \
    -DWITH_SYSTEM_PCRE=yes \
    -DWITH_SYSTEM_OGG=yes

variant networking description {Networking support} {
	configure.args-append -DWITH_NETWORKING=yes
}

variant ffmpeg description {Enable ffmpeg} {
    configure.args-append -DWITH_FFMPEG=yes -DWITH_SYSTEM_FFMPEG=yes
    depends_lib-append port:ffmpeg
}

variant crash_handler description {Enable crash handler} {
    configure.args-append -DWITH_CRASH_HANDLER=yes
}

variant gpl description {Enable GPL code (non-distributable binary)} {
    configure.args-append -DWITH_GPL_LIBS=yes -DWITH_MP3=yes -DWITH_SYSTEM_MAD=yes
    depends_lib-append port:libmad
}

variant lto description {Enable link time optimisation} {
	configure.args-append -DWITH_LTO=yes
}

# variant bundled_songs description {Do not install bundled songs} {}

# variant bundled_courses description {Do not install bundled courses} {}

default_variants    +networking +ffmpeg +crash_handler +gpl

destroot {
    set dirnames {Announcers BGAnimations BackgroundEffects
                  BackgroundTransitions Characters Courses
                  Data Docs Manual NoteSkins Scripts Songs Themes
                  StepMania.app}
    xinstall -d "${destroot}/${applications_dir}/StepMania/"
    foreach dir $dirnames {
        file copy "${worksrcpath}/${dir}" "${destroot}/${applications_dir}/StepMania/"
    }
}
