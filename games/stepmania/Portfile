PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0

github.setup        stepmania stepmania d6bd000

version             5.1.0_beta2_p20190318
categories          games
platforms           darwin linux freebsd
license             MIT
maintainers         {gmail.com:audvare @Tatsh}
description         Rhythm game.
long_description    StepMania is a free dance and rhythm game.

checksums           rmd160  a913037ddde1d5e448b155f845eaa7b23a5f131b \
                    sha256  93fe7a5fd9e06f8c2bc71e56282fc9ba47feee9c1af04520e4407a5e8d779939 \
                    size    186503470

patchfiles          noexcept.patch
patch.pre_args      -p1 -R

depends_build-append port:yasm
depends_lib \
    port:libvorbis \
    port:jpeg \
    port:glew \
    port:pcre \
    port:libogg \
    port:libtommath

configure.args-append \
    -DWITH_FULL_RELEASE=yes \
    -DWITH_PORTABLE_TOMCRYPT=no \
    -DWITH_GLES2=yes \
    -DWITH_JPEG=yes \
    -DWITH_OGG=yes \
    -DWITH_WAV=yes \
    -DWITH_SYSTEM_GLEW=yes \
    -DWITH_SYSTEM_TOMMATH=yes \
    -DWITH_SYSTEM_ZLIB=yes \
    -DWITH_SYSTEM_JSONCPP=no \
    -DWITH_SYSTEM_PNG=no \
    -DWITH_SYSTEM_JPEG=yes \
    -DWITH_SYSTEM_PCRE=yes \
    -DWITH_SYSTEM_OGG=yes

variant networking description {Networking support} {
	configure.args-append -DWITH_NETWORKING=yes
}

variant ffmpeg description {Enable ffmpeg} {
    configure.args-append -DWITH_FFMPEG=yes -DWITH_SYSTEM_FFMPEG=yes
    depends_lib-append port:ffmpeg
}

variant crash_handler description {Enable crash handler} {
    configure.args-append -DWITH_CRASH_HANDLER=yes
}

variant gpl description {Enable GPL code (non-distributable binary)} {
    configure.args-append -DWITH_GPL_LIBS=yes -DWITH_MP3=yes -DWITH_SYSTEM_MAD=yes
    depends_lib-append port:libmad
}

variant lto description {Enable link time optimisation} {
	configure.args-append -DWITH_LTO=yes
}

# variant bundled_songs description {Do not install bundled songs} {}

# variant bundled_courses description {Do not install bundled courses} {}

default_variants    +networking +ffmpeg +crash_handler +gpl

destroot {
    set dirnames {Announcers BGAnimations BackgroundEffects
                  BackgroundTransitions Characters Courses
                  Data Docs Manual NoteSkins Scripts Songs Themes
                  StepMania.app}
    xinstall -d "${destroot}/${applications_dir}/StepMania/"
    foreach dir $dirnames {
        file copy "${worksrcpath}/${dir}" "${destroot}/${applications_dir}/StepMania/"
    }
}
