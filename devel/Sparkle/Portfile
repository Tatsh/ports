PortSystem          1.0
PortGroup           xcode 1.0
PortGroup           github 1.0

name                Sparkle
version             1.23.0_p20201026
set sha             dbfb300
set ed25519_sha     7fa6712
github.setup        sparkle-project ${name} dbfb300

license             MIT
maintainers         {gmail.com:audvare @Tatsh}
description         A software update framework for macOS.
long_description    ${description}
categories          devel

master_sites        ${github.homepage}/tarball/${git.branch}:commandant \
                    https://github.com/orlp/ed25519/tarball/${ed25519_sha}:ed2
worksrcdir          sparkle-project-${name}-${sha}
distfiles           ${name}-${version}.tar.gz:commandant \
                    orlp-ed25519-${ed25519_sha}.tar.gz:ed2

checksums           Sparkle-dbfb300.tar.gz \
                    rmd160  4d154f1ab5cdeb14d5f2ad77c2790fac62a0967d \
                    sha256  8bd96d4defe4198bc5839a4cd56286253dbc3eedd9648e9b6a96f392fe6a3e2b \
                    size    8380127 \
                    orlp-ed25519-7fa6712.tar.gz \
                    rmd160  a9e26ac9814ccaa455937bad623df4626fb79100 \
                    sha256  75308c8f0c983aaa7aef8a8979868981ad383bd30de43abc94d42d400af39329 \
                    size    226610

xcode.target        ${name}
xcode.configuration Release
xcode.build.settings \
    DEVELOPMENT_TEAM="" \
    CODE_SIGN_IDENTITY=- \
    CODE_SIGN_STYLE=Manual
xcode.destroot.settings \
    DEVELOPMENT_TEAM="" \
    CODE_SIGN_IDENTITY=- \
    CODE_SIGN_STYLE=Manual

patchfiles      project-fixes.patch
patch.pre_args  -p1

pre-configure {
    file delete -force ${worksrcpath}/Vendor/ed25519
    file copy "${workpath}/orlp-ed25519-${ed25519_sha}" "${worksrcpath}/Vendor/ed25519"
}

destroot {
    file copy ${worksrcpath}/build/Release/${name}.framework \
        ${destroot}${prefix}/Library/Frameworks/
}
