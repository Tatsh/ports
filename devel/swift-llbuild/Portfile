PortSystem          1.0
PortGroup           xcode 1.0
PortGroup           github 1.0

set git_version     swift-DEVELOPMENT-SNAPSHOT-2019-08-09-a
github.setup        apple swift-llbuild ${git_version}

name                swift-llbuild
version             20190809a
license             MIT
maintainers         {gmail.com:audvare @Tatsh}
description         A low-level build system, used by Xcode and the Swift Package Manager.
long_description    ${description}
categories          devel

checksums           rmd160  6c477066e451b46ff4e3d867d51fc09a47617e55 \
                    sha256  46a9878b8db297be9af145cbd241f18760b1691c09df3a2900049e2da021148c \
                    size    5392490

xcode.target        libllbuild "llbuild Tool" swift-build-tool
xcode.configuration Release

pre-fetch {
    if { [vercmp ${xcodeversion} "10.0"] < 0 } {
        ui_error "Xcode 10.0 or greater is needed to build ${name}; only found version ${xcodeversion}."
        return -code error "incompatible Xcode version"
    }
}

destroot {
    xinstall -m 755 {*}[glob ${worksrcpath}/build/Release/*.dylib] ${destroot}${prefix}/lib/
    xinstall -m 755 ${worksrcpath}/build/Release/llbuild ${destroot}${prefix}/bin/
    xinstall -m 755 ${worksrcpath}/build/Release/swift-build-tool ${destroot}${prefix}/bin/
}
