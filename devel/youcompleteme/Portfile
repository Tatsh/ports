# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup            ycm-core YouCompleteMe 604a2a0
name                    youcompleteme
version                 20201113
categories              textproc devel
maintainers             {gmail.com:audvare @Tatsh}
description             A code-completion engine for Vim.
long_description        ${description}

checksums           rmd160  c08a9082725b6819146ec33a672f9801979b09de \
                    sha256  37be7d9cef5266d714414bc0ef36f6b1e2f548b45faeb474589cc5db9a299ec7 \
                    size    288836

set python_minor_version 8
set python_framework_dir ${frameworks_dir}/Python.framework/Versions/3.${python_minor_version}
set python_site_packages_dir ${python_framework_dir}/lib/python3.${python_minor_version}/site-packages
set clang_version 10

depends_lib \
    port:clang-${clang_version} \
    port:python3${python_minor_version}
depends_run \
    port:py3${python_minor_version}-requests-futures \
    port:py3${python_minor_version}-requests \
    port:vim \
    port:ycmd

use_configure no

patchfiles      python-path.patch

post-patch {
    file delete -force ${worksrcpath}/python/ycm/tests
    file delete -force ${worksrcpath}/third_party
    reinplace "s|@PYTHON_SITE_PACKAGES_DIR@|${python_site_packages_dir}|" \
        ${worksrcpath}/python/ycm/paths.py
}

build {
    system "python -m compileall ${worksrcpath}/python/ycm"
}

destroot {
    xinstall -d ${destroot}${python_framework_dir}
    xinstall -d ${destroot}${python_framework_dir}/lib
    xinstall -d ${destroot}${python_framework_dir}/lib/python3.${python_minor_version}
    xinstall -d ${destroot}${python_framework_dir}/lib/python3.${python_minor_version}/site-packages
    copy ${worksrcpath}/python/ycm ${destroot}${python_site_packages_dir}
    xinstall -d ${destroot}${prefix}/share/vim
    xinstall -d ${destroot}${prefix}/share/vim/vimfiles
    xinstall -d ${destroot}${prefix}/share/vim/vimfiles/plugin
    xinstall -d ${destroot}${prefix}/share/vim/vimfiles/autoload
    xinstall -m 0644 ${worksrcpath}/autoload/${name}.vim \
        ${destroot}${prefix}/share/vim/vimfiles/autoload/
    xinstall -m 0644 ${worksrcpath}/plugin/${name}.vim \
        ${destroot}${prefix}/share/vim/vimfiles/plugin/
    xinstall -d ${destroot}${prefix}/share/doc
    xinstall -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 0644 ${worksrcpath}/doc/${name}.txt \
        ${destroot}${prefix}/share/doc/${name}/
}
